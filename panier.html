<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Panier – Nexio</title>

<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;600;800&family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
<script src="https://js.stripe.com/v3/"></script>

<style>
/* === (TON CSS INCHANGÉ, je n’ai rien cassé) === */
:root{
    --neon:#00ffff;
    --violet:#8b5cf6;
    --bg:#020617;
    --bg-card:rgba(15,23,42,.75);
    --border:rgba(255,255,255,.08);
    --text:#e5e7eb;
    --muted:#94a3b8;
}
*{margin:0;padding:0;box-sizing:border-box}
body{
    background:radial-gradient(circle at top,#020617,#000);
    color:var(--text);
    font-family:'Inter',sans-serif;
}
.section{max-width:1200px;margin:auto;padding:4rem 2rem}
.cart{display:grid;grid-template-columns:2fr 1fr;gap:2rem}
.cart-item{
    background:var(--bg-card);
    border:1px solid var(--border);
    border-radius:18px;
    padding:1rem;
    display:flex;
    justify-content:space-between;
    align-items:center;
}
.quantity button{
    width:30px;height:30px;border:none;
    background:var(--bg-card);color:var(--neon);
    border-radius:8px;cursor:pointer
}
.remove{
    background:none;border:none;
    color:#ef4444;font-size:.9rem;
    cursor:pointer;
}
.checkout{
    display:block;text-align:center;margin-top:2rem;
    padding:1rem;border-radius:14px;
    background:linear-gradient(135deg,var(--neon),var(--violet));
    color:#000;font-weight:700;text-decoration:none;
}
</style>
</head>

<body>

<section class="section">
<h1>Votre Panier</h1>

<div class="cart">
    <div id="cart-items"></div>

    <div>
        <p>Sous-total : <span id="subtotal">0</span> €</p>
        <p><strong>Total : <span id="total">0</span> €</strong></p>
        <button class="checkout" onclick="pay()">Payer avec Stripe</button>
    </div>
</div>
</section>

<script>
const stripe = Stripe("pk_test_TA_CLE_PUBLIQUE_ICI");

/* === PANIER === */
function getCart(){
    return JSON.parse(localStorage.getItem("cart")) || [];
}
function saveCart(cart){
    localStorage.setItem("cart", JSON.stringify(cart));
}
function renderCart(){
    const cart = getCart();
    const container = document.getElementById("cart-items");
    container.innerHTML = "";
    let total = 0;

    cart.forEach((item,index)=>{
        total += item.price * item.quantity;
        container.innerHTML += `
        <div class="cart-item">
            <div>
                <strong>${item.name}</strong><br>
                ${item.price} €
            </div>
            <div class="quantity">
                <button onclick="changeQty(${index},-1)">-</button>
                ${item.quantity}
                <button onclick="changeQty(${index},1)">+</button>
            </div>
            <button class="remove" onclick="removeItem(${index})">Supprimer</button>
        </div>`;
    });

    document.getElementById("subtotal").textContent = total;
    document.getElementById("total").textContent = total;
}
function changeQty(index,delta){
    const cart = getCart();
    cart[index].quantity += delta;
    if(cart[index].quantity <= 0) cart.splice(index,1);
    saveCart(cart);
    renderCart();
}
function removeItem(index){
    const cart = getCart();
    cart.splice(index,1);
    saveCart(cart);
    renderCart();
}

/* === STRIPE === */
async function pay(){
    const cart = getCart();

    const res = await fetch("http://localhost:4242/create-checkout-session",{
        method:"POST",
        headers:{ "Content-Type":"application/json" },
        body: JSON.stringify({ cart })
    });

    const session = await res.json();
    stripe.redirectToCheckout({ sessionId: session.id });
}

renderCart();
</script>

</body>
</html>
